{% extends "base.html" %}

{% block title %}Grading - Admin{% endblock %}

{% block content %}
<nav class="nav">
    <a href="/home">Home</a>
    <a href="/admin/analytics">Analytics</a>
    <a href="/admin/grading">Grading</a>
</nav>

<h1>Grading</h1>

<div style="margin-bottom: 1rem;">
    <a href="/admin/grading/csv" class="btn btn-outline btn-sm">Download CSV</a>
</div>

{% if not roster %}
<p class="text-muted">No students enrolled yet.</p>
{% elif not quizzes %}
<p class="text-muted">No quizzes available yet.</p>
{% else %}
<div class="table-container">
    <table class="grading-table">
        <thead>
            <tr>
                <th class="sticky-col">Student Name</th>
                <th>Email</th>
                <th>Student ID</th>
                {% for quiz in quizzes %}
                <th class="quiz-col">{{ quiz.title }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for student in roster %}
            <tr>
                <td class="sticky-col">{{ student.full_name }}</td>
                <td>{{ student.preferred_email or '' }}</td>
                <td>{{ student.student_id }}</td>
                {% for quiz in quizzes %}
                {% set score = grades.get(student.student_id, {}).get(quiz.quiz_id, 0) %}
                <td class="score-cell">{{ score | int }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
{% endblock %}

{% block head %}
<style>
    .table-container {
        overflow-x: auto;
        margin-top: 1rem;
    }

    .grading-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.875rem;
    }

    .grading-table th,
    .grading-table td {
        padding: 0.5rem 0.75rem;
        text-align: left;
        border-bottom: 1px solid #eee;
        white-space: nowrap;
    }

    .grading-table th {
        font-weight: 500;
        color: #666;
        background: #f8f9fa;
        position: sticky;
        top: 0;
    }

    .grading-table tbody tr:hover {
        background: #f8f9fa;
    }

    .sticky-col {
        position: sticky;
        left: 0;
        background: #fff;
        z-index: 1;
    }

    .grading-table th.sticky-col {
        background: #f8f9fa;
        z-index: 2;
    }

    .grading-table tbody tr:hover .sticky-col {
        background: #f8f9fa;
    }

    .quiz-col {
        text-align: center;
        min-width: 80px;
    }

    .score-cell {
        text-align: center;
    }

    .btn-sm {
        padding: 0.375rem 0.75rem;
        font-size: 0.875rem;
        width: auto;
        display: inline-block;
    }
</style>
{% endblock %}
